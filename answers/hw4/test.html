<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="stylesheet" href="assets/css/style.css"></link>
	<script src="assets/js/index.js" defer></script>
</head>
<body>
	<div class="wrapper" id ="wrapper">
		<ul class="bg" id="bg"><li class="row" id="row"></li></ul>
	</div>

	<script>
		var Ajax = (function() {
			function doAjax() {
				var xhttp = new XMLHttpRequest();
				xhttp.onreadystatechange = function() {
					if (this.readyState == 4) {
						if (this.status == 200) {
							var JSONData = JSON.parse(this.responseText);
							var aryOfJSON = JSONData.streams;
							Append.createDOM(aryOfJSON);
						} else {
							var liZone = document.getElementById("row");
							liZone.innerHTML = "sorry, fail to load data!";
						}
					}
				};
				xhttp.open("GET", "https://api.twitch.tv/kraken/streams/?game=League%20of%20Legends&limit=20", true);
				xhttp.setRequestHeader("Accept", "application/vnd.twitchtv.v5+json");
				xhttp.setRequestHeader('client-id','uivr9vpjkf35a0qdxpwdf5ob2b8es3');
				xhttp.send();
			}
			return {
				"doAjax": doAjax
			}
		})();

		var Append = (function() {
			function createDOM(_ary) {
				var liZone = document.getElementById("row");
				var aryLen = _ary.length + 1;
				for (var i = 0; i < aryLen; i++) {
					var eachAryItem = _ary[i];
					var colDiv = document.createElement("div");
					colDiv.setAttribute("class", "col");
					liZone.appendChild(colDiv);

					var figure = document.createElement("figure");
					figure.setAttribute("class", "preview");
					colDiv.appendChild(figure);

					var previewImg = document.createElement("img");
					previewImg.setAttribute("id", "videoBanner");
					previewImg.setAttribute("src", eachAryItem.preview.medium);
					figure.appendChild(previewImg);

					var introListDiv = document.createElement("div");
					introListDiv.setAttribute("class", "intro");
					colDiv.appendChild(introListDiv);

					var introFigure = document.createElement("figure");
					introListDiv.appendChild(introFigure);

					var introImg = document.createElement("img");
					introImg.setAttribute("id", "logo");
					introImg.setAttribute("src", eachAryItem.channel.logo);
					introFigure.appendChild(introImg);

					var introNameListDiv = document.createElement("div");
					introNameListDiv.setAttribute("class", "introNameList");
					introListDiv.appendChild(introNameListDiv);

					var h3 = document.createElement("h3");
					h3.setAttribute("id", "channelName");
					var h3Txt = document.createTextNode(eachAryItem.channel.name);
					h3.appendChild(h3Txt);
					introNameListDiv.appendChild(h3);

					var span = document.createElement("span");
					span.setAttribute("id", "channelHost");
					var spanTxt = document.createTextNode(eachAryItem.channel.display_name);
					span.appendChild(spanTxt);
					introNameListDiv.appendChild(span);
				}
			}
			return {
				"createDOM": createDOM
			}
		})();

		function init() {
			Ajax.doAjax();
		}

		window.onload = init();

	</script>
</body>
</html>